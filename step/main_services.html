<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ø­ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</title>
    <link rel="stylesheet" href="style.css">
    <script src="data/data_config.js"></script>
    <style>
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); 
            gap: 20px;
            margin-top: 30px;
        }
        .service-card {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: background-color 0.3s, border-color 0.3s;
            text-decoration: none;
            color: var(--white);
            font-weight: bold;
        }
        .service-card:hover {
            background-color: var(--blue-dark);
            border-color: var(--gold);
        }
        .service-card span {
            display: block;
            font-size: 2em;
            margin-bottom: 10px;
        }
        /* ØªÙ…ÙŠÙŠØ² Ø²Ø± Ø§Ù„Ø´Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
        .service-card.chat-card {
            border-color: var(--blue-royal);
            background-color: #333d52;
        }
    </style>
</head>
<body>
    <button onclick="handleEmergency()" class="btn-emergency">
        ğŸš¨
    </button>
    
    <div class="header-controls">
        <button onclick="logoutTourist()" class="btn-back" style="background-color: var(--red-emergency);">ğŸšª Ø®Ø±ÙˆØ¬</button>
        <button onclick="openComplaintModal()" class="btn-back" style="background-color: var(--blue-royal);">ğŸ“ Ø´ÙƒÙˆÙ‰ / Ø§Ù‚ØªØ±Ø§Ø­</button>
    </div>

    <div class="container">
        <h1>Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª! ğŸ‘‹</h1>
        
        <div class="services-grid">
            
            <a href="assistants_cards.html?role=GUIDE" class="service-card">
                <span>ğŸ‘¤</span> Ø§Ù„Ù…Ø±Ø´Ø¯ÙŠÙ† Ø§Ù„Ø³ÙŠØ§Ø­ÙŠÙŠÙ†
            </a>
            <a href="assistants_cards.html?role=COMPANION" class="service-card">
                <span>â™¿</span> Ù…Ø±Ø§ÙÙ‚Ùˆ Ø°ÙˆÙŠ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø¬Ø§Øª Ø§Ù„Ø®Ø§ØµØ©
            </a>
            <a href="assistants_cards.html?role=DRIVER" class="service-card">
                <span>ğŸš—</span> Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªÙ†Ù‚Ù„ (Ø³Ø§Ø¦Ù‚ÙŠÙ†)
            </a>
            
            <a href="hotels.html" class="service-card">
                <span>ğŸ¨</span> Ø§Ù„ÙÙ†Ø§Ø¯Ù‚ Ø§Ù„Ù‚Ø±ÙŠØ¨Ø©
            </a>
            <a href="restaurants.html" class="service-card">
                <span>ğŸ´</span> Ø§Ù„Ù…Ø·Ø§Ø¹Ù…
            </a>
            <a href="stores.html" class="service-card">
                <span>ğŸ›ï¸</span> Ø§Ù„Ù…Ø­Ù„Ø§Øª Ø§Ù„ØªØ¬Ø§Ø±ÙŠØ©
            </a>

            <a href="gemini_chat_bot.html" class="service-card chat-card">
                <span>ğŸ¤–</span> **Ø§Ù„Ø´Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø­ÙŠ**
            </a>

            <a href="https://alisedafnan-maker.github.io/mywebapp/turesm.html" class="service-card">
                <span>ğŸ—ºï¸</span> Ø§Ù„Ù…Ø¹Ø§Ù„Ù… Ø§Ù„Ø³ÙŠØ§Ø­ÙŠØ©
            </a>

        </div>
    </div>
    
    <div id="complaintModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('complaintModal')">Ã—</span>
            <h2>ğŸ“ Ø´ÙƒÙˆÙ‰ Ø£Ùˆ Ø§Ù‚ØªØ±Ø§Ø­</h2>
            <form id="complaintForm">
                <div class="form-group">
                    <label for="complaintName">Ø§Ù„Ø§Ø³Ù…:</label>
                    <input type="text" id="complaintName" required>
                </div>
                 <div class="form-group">
                    <label for="complaintPhone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</label>
                    <input type="tel" id="complaintPhone" required>
                </div>
                <div class="form-group">
                    <label for="complaintType">Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:</label>
                    <select id="complaintType" required>
                        <option value="">-- Ø§Ø®ØªØ± --</option>
                        <option value="Ø´ÙƒÙˆÙ‰">Ø´ÙƒÙˆÙ‰</option>
                        <option value="Ø§Ù‚ØªØ±Ø§Ø­">Ø§Ù‚ØªØ±Ø§Ø­</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="complaintMessage">Ø§Ù„ØªÙØ§ØµÙŠÙ„:</label>
                    <textarea id="complaintMessage" rows="4" required></textarea>
                </div>
                <button type="submit" class="btn-primary">ğŸ’¾ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</button>
                <p id="complaintMessageResult" style="margin-top: 10px;"></p>
            </form>
        </div>
    </div>

    <script>
        const saveEmergencyLog = (location) => {
            const data = window.loadData();
            let logs = data[window.KEYS.EMERGENCIES] || [];
            
            logs.push({
                id: Date.now().toString(),
                time: new Date().toLocaleString('ar-EG', { timeZone: 'Africa/Cairo' }),
                location: location,
                status: 'Ø¬Ø¯ÙŠØ¯',
                ticketCode: sessionStorage.getItem('currentTicket') || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'
            });
            window.saveDataToStorage(window.KEYS.EMERGENCIES, logs);
        };
        
        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }
        
        function openComplaintModal() {
            document.getElementById('complaintModal').style.display = 'block';
            document.getElementById('complaintForm').reset();
            document.getElementById('complaintMessageResult').textContent = '';
        }

        // Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø³ÙÙ„
        function scrollToBottom() {
            window.scrollTo({
                top: document.body.scrollHeight,
                behavior: 'smooth'
            });
        }
        
        function handleEmergency() {
            if (confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù„Ø§Øº Ø·Ø§Ø±Ø¦ Ù„Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆØ§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø±Ù‚Ù… 999ØŸ")) {
                window.location.href = 'tel:999';

                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition((position) => {
                        const lat = position.coords.latitude;
                        const lng = position.coords.longitude;
                        const gMapsURL = `https://www.google.com/maps/search/?api=1&query=${lat},${lng}`;
                        saveEmergencyLog({ lat: lat, lng: lng, gMapsURL: gMapsURL });
                        alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØ§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø·ÙˆØ§Ø±Ø¦.");
                    }, () => {
                        alert("âš ï¸ ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ. ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡ Ù„Ù„Ø¥Ø¯Ø§Ø±Ø©.");
                        saveEmergencyLog("ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹");
                    }, { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 });
                } else {
                    alert("âŒ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ.");
                    saveEmergencyLog("Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹");
                }
            }
        }
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø´ÙƒÙˆÙ‰ (ØªÙ… ØªØ­Ø¯ÙŠØ«Ù‡ Ù„Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ…Ø±ÙŠØ±)
        document.getElementById('complaintForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const name = document.getElementById('complaintName').value.trim();
            const phone = document.getElementById('complaintPhone').value.trim();
            const type = document.getElementById('complaintType').value;
            const message = document.getElementById('complaintMessage').value.trim();
            const msgBox = document.getElementById('complaintMessageResult');

            if (!name || !phone || !type || !message) {
                 msgBox.textContent = "ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.";
                 msgBox.style.color = 'var(--red-emergency)';
                 return;
            }

            const data = window.loadData();
            let complaints = data[window.KEYS.COMPLAINTS] || [];
            
            complaints.push({
                id: Date.now().toString().slice(-6),
                time: new Date().toLocaleString('ar-EG', { timeZone: 'Africa/Cairo' }),
                name: name,
                phone: phone,
                type: type,
                message: message,
                ticketCode: sessionStorage.getItem('currentTicket')
            });

            window.saveDataToStorage(window.KEYS.COMPLAINTS, complaints);
            
            msgBox.textContent = `âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ ${type}Ùƒ Ø¨Ù†Ø¬Ø§Ø­. Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ.`;
            msgBox.style.color = 'var(--green-success)';
            document.getElementById('complaintForm').reset();
            
            setTimeout(() => {
                closeModal('complaintModal');
                scrollToBottom(); // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø£Ø³ÙÙ„ Ø§Ù„ØµÙØ­Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
            }, 500);
        });

        function logoutTourist() {
            sessionStorage.removeItem('currentTicket');
            window.location.href = 'index.html';
        }
        
        function checkTicketValidity() {
            if (!sessionStorage.getItem('currentTicket')) {
                 console.log("Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙƒÙˆØ¯ ØªØ°ÙƒØ±Ø© ÙØ¹Ø§Ù„.");
            }
        }

        document.addEventListener('DOMContentLoaded', checkTicketValidity);
    </script>
</body>
</html>
