<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¯Ø§Ø±Ø© Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„ØªØ°Ø§ÙƒØ±</title>
    <link rel="stylesheet" href="style.css">
    <script src="data/data_config.js"></script>
    <style>
        .tickets-table td { font-size: 0.9em; }
        .tickets-table .expired { color: var(--red-emergency); font-weight: bold; }
    </style>
</head>
<body>
    <div class="header-controls">
        <a href="manager_dashboard.html" class="btn-back">ğŸ”™ Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±</a>
    </div>

    <div class="container">
        <h1>Ø¥Ø¯Ø§Ø±Ø© Ø£ÙƒÙˆØ§Ø¯ ØªØ°Ø§ÙƒØ± Ø§Ù„Ø³Ø§Ø¦Ø­ÙŠÙ† ğŸŸï¸</h1>

        <h2>Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ¯ ØªØ°ÙƒØ±Ø© Ø¬Ø¯ÙŠØ¯</h2>
        <div id="addTicketForm" style="border: 1px solid var(--gold); padding: 20px; border-radius: 8px; margin-bottom: 30px;">
            <div class="form-group">
                <label for="newTicketCode">ÙƒÙˆØ¯ Ø§Ù„ØªØ°ÙƒØ±Ø©:</label>
                <input type="text" id="newTicketCode" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ ÙØ±ÙŠØ¯" required>
            </div>
            <div class="form-group">
                <label for="expiryDate">ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©:</label>
                <input type="date" id="expiryDate" required>
            </div>
            <button onclick="addTicket()" class="btn-primary">â• Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙˆØ¯</button>
            <p id="ticketMessage" style="margin-top: 10px; color: var(--green-success); display: none;"></p>
        </div>

        <h2>Ù‚Ø§Ø¦Ù…Ø© Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„ØªØ°Ø§ÙƒØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
        <div id="ticketListContainer">
            <table class="requests-table tickets-table">
                <thead>
                    <tr>
                        <th>Ø§Ù„ÙƒÙˆØ¯</th>
                        <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                    </tr>
                </thead>
                <tbody id="ticketsTableBody">
                </tbody>
            </table>
        </div>
        
        <p id="noTicketsMessage" style="text-align: center; color: var(--gold); margin-top: 50px; display: none;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙƒÙˆØ§Ø¯ ØªØ°Ø§ÙƒØ± Ù…Ø¯Ø®Ù„Ø©.</p>
    </div>

    <script>
        const loadData = window.loadData;
        const saveDataToStorage = window.saveDataToStorage;
        const KEYS = window.KEYS;

        function displayTickets() {
            const data = loadData();
            const tickets = data[KEYS.TICKET_CODES] || [];
            const tbody = document.getElementById('ticketsTableBody');
            const noTicketsMessage = document.getElementById('noTicketsMessage');
            tbody.innerHTML = '';
            
            if (tickets.length === 0) {
                noTicketsMessage.style.display = 'block';
                return;
            }
            noTicketsMessage.style.display = 'none';

            const today = new Date();

            tickets.forEach(ticket => {
                const tr = document.createElement('tr');
                const expiry = new Date(ticket.expiryDate);
                const isExpired = expiry < today;
                
                tr.innerHTML = `
                    <td>${ticket.code}</td>
                    <td>${ticket.expiryDate}</td>
                    <td class="${isExpired ? 'expired' : ''}">
                        ${isExpired ? 'Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© ğŸš«' : 'ÙØ¹Ø§Ù„ âœ…'}
                    </td>
                    <td>
                        <button onclick="removeTicket('${ticket.code}')" class="btn-back" style="background-color: var(--red-emergency);">ğŸ—‘ï¸ Ø­Ø°Ù</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        function addTicket() {
            const code = document.getElementById('newTicketCode').value.trim();
            const expiryDate = document.getElementById('expiryDate').value;
            const msg = document.getElementById('ticketMessage');
            msg.style.display = 'none';

            if (!code || !expiryDate) {
                msg.textContent = "âŒ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„.";
                msg.style.backgroundColor = 'var(--red-emergency)';
                msg.style.display = 'block';
                return;
            }

            const data = loadData();
            let tickets = data[KEYS.TICKET_CODES] || [];
            
            if (tickets.some(t => t.code === code)) {
                 msg.textContent = "âŒ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„.";
                 msg.style.backgroundColor = 'var(--red-emergency)';
                 msg.style.display = 'block';
                 return;
            }

            tickets.push({ code: code, expiryDate: expiryDate });
            saveDataToStorage(KEYS.TICKET_CODES, tickets);
            
            msg.textContent = `âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙˆØ¯ ${code} Ø¨Ù†Ø¬Ø§Ø­.`;
            msg.style.backgroundColor = 'var(--green-success)';
            msg.style.display = 'block';
            document.getElementById('addTicketForm').reset();
            displayTickets();
        }
        
        function removeTicket(code) {
            if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ÙƒÙˆØ¯ Ø§Ù„ØªØ°ÙƒØ±Ø© ${code}ØŸ`)) {
                const data = loadData();
                let tickets = data[KEYS.TICKET_CODES] || [];
                const updatedTickets = tickets.filter(t => t.code !== code);
                
                saveDataToStorage(KEYS.TICKET_CODES, updatedTickets);
                displayTickets();
                alert(`âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ¯ ${code}.`);
            }
        }

        document.addEventListener('DOMContentLoaded', displayTickets);
    </script>
</body>
</html>
