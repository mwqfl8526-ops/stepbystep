<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุณุฌู ุงูุทูุงุฑุฆ</title>
    <link rel="stylesheet" href="style.css">
    <script src="data/data_config.js"></script>
</head>
<body>
    <div class="header-controls">
        <a href="manager_dashboard.html" class="btn-back">๐ ููุญุฉ ุงููุฏูุฑ</a>
    </div>

    <div class="container">
        <h1>ุณุฌู ุจูุงุบุงุช ุงูุทูุงุฑุฆ ๐จ</h1>
        <p>ููุง ูุชู ุนุฑุถ ุจูุงุบุงุช ุงูุทูุงุฑุฆ ุงููุฑุณูุฉ ูู ุงูุณูุงุญ ูุน ุงููููุน ุงูุฌุบุฑุงูู.</p>
        
        <button onclick="displayEmergencyLogs()" class="btn-primary" style="margin-top: 15px;">๐ ุชุญุฏูุซ ุงูุณุฌู</button>
        <button onclick="confirmDeleteAllLogs()" class="btn-back" style="background-color: var(--red-emergency);">๐๏ธ ุญุฐู ุฌููุน ุงูุณุฌูุงุช</button>

        <div id="logsList" class="requests-table-container">
            <table class="requests-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>ููุช ุงูุจูุงุบ</th>
                        <th>ุงููููุน</th>
                        <th>ุงูุฅุฌุฑุงุกุงุช</th>
                    </tr>
                </thead>
                <tbody id="emergencyTableBody">
                    </tbody>
            </table>
        </div>
        
        <p id="noLogsMessage" style="text-align: center; color: var(--gold); margin-top: 50px; display: none;">ูุง ุชูุฌุฏ ุจูุงุบุงุช ุทูุงุฑุฆ ุฌุฏูุฏุฉ.</p>

    </div>

    <script>
        const loadData = window.loadData;
        const deleteEmergency = window.deleteEmergency;
        const saveDataToStorage = window.saveDataToStorage;
        const KEYS = window.KEYS;

        function displayEmergencyLogs() {
            const data = loadData();
            const logs = data[KEYS.EMERGENCIES] || [];
            const tbody = document.getElementById('emergencyTableBody');
            const noLogsMessage = document.getElementById('noLogsMessage');
            tbody.innerHTML = '';

            if (logs.length === 0) {
                noLogsMessage.style.display = 'block';
                return;
            }
            noLogsMessage.style.display = 'none';

            logs.forEach(log => {
                const tr = document.createElement('tr');
                
                let locationCell;
                if (log.location && log.location.gMapsURL) {
                     locationCell = `<a href="${log.location.gMapsURL}" target="_blank" class="btn-primary" style="background-color: var(--red-emergency);">๐ด ุนุฑุถ ุงููููุน ุงูุญู</a>
                                     <br><small>(${log.location.lat}, ${log.location.lng})</small>`;
                } else {
                     locationCell = log.location || "ุชุนุฐุฑ ุฅุฑุณุงู ุงููููุน";
                }

                tr.innerHTML = `
                    <td>${log.id}</td>
                    <td>${log.time}</td>
                    <td>${locationCell}</td>
                    <td><button onclick="removeLog('${log.id}')" class="btn-back" style="background-color: #8c1a1a;">๐๏ธ ุญุฐู ุงูุจูุงุบ</button></td>
                `;
                tbody.appendChild(tr);
            });
        }
        
        function removeLog(id) {
            if (confirm(`ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุจูุงุบ ุงูุทูุงุฑุฆ ุฑูู ${id}ุ`)) {
                if (deleteEmergency(id)) {
                    alert('โ ุชู ุญุฐู ุงูุจูุงุบ ุจูุฌุงุญ.');
                    displayEmergencyLogs();
                } else {
                    alert('โ ูุดู ุญุฐู ุงูุจูุงุบ.');
                }
            }
        }
        
        function confirmDeleteAllLogs() {
             if (confirm("ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุฌููุน ุณุฌูุงุช ุงูุทูุงุฑุฆุ ูุฐุง ุงูุฅุฌุฑุงุก ูุง ูููู ุงูุชุฑุงุฌุน ุนูู.")) {
                 saveDataToStorage(KEYS.EMERGENCIES, []);
                 displayEmergencyLogs();
                 alert("โ ุชู ุญุฐู ุฌููุน ุณุฌูุงุช ุงูุทูุงุฑุฆ ุจูุฌุงุญ.");
             }
        }

        document.addEventListener('DOMContentLoaded', displayEmergencyLogs);
    </script>
</body>
</html>
